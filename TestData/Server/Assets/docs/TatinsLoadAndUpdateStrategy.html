<!DOCTYPE html>
<html lang="en" style="scroll-behavior:smooth" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta charset="utf-8">
<title>Tatin Load & Update</title>
<style media="screen">
html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;}body{margin:0;}article,aside,footer,header,nav,section{display:block;}h1{font-size:2em;margin:0.67em 0;}figcaption,figure,main{display:block;}figure{margin:1em 40px;}hr{box-sizing:content-box;height:0;overflow:visible;}pre{font-family:monospace, monospace;font-size:1em;}a{background-color:transparent;-webkit-text-decoration-skip:objects;}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted;}b,strong{font-weight:inherit;}b,strong{font-weight:bolder;}code,kbd,samp{font-family:monospace, monospace;font-size:1em;}dfn{font-style:italic;}mark{background-color:#ff0;color:#000;}small{font-size:0.8em;}sub,sup{font-size:0.75em;line-height:0;position:relative;vertical-align:baseline;}sub{bottom:-0.25em;}sup{top:-0.5em;}audio,video{display:inline-block;}audio:not([controls]){display:none;height:0;}img{border-style:none;}svg:not(:root){overflow:hidden;}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:1em;line-height:1.15;margin:0;}button,input{overflow:visible;}button,select{text-transform:none;}button,html [type="button"], [type="reset"],[type="submit"]{-webkit-appearance:button;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;}fieldset{padding:0.35em 0.75em 0.625em;}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}progress{display:inline-block;vertical-align:baseline;}textarea{overflow:auto;}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}[type="search"]::-webkit-search-cancel-button,[type="search"]::-webkit-search-decoration{-webkit-appearance:none;}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}details, menu{display:block;}summary{display:list-item;}canvas{display:inline-block;}template{display:none;}[hidden]{display:none;}body{margin:0;font-family:"Bookman Old Style", "Callisto MT", Bookman, "Goudy Old Style", Garamond, serif;background-color:#fdfdfd;font-size:18px;line-height:1.4;max-width:900px;padding:0.83em;color:#292929;word-wrap:break-word;overflow-wrap:break-word;}h1, h2, h3, h4, h5, h6{color:#404040;font-weight:800;padding-left:0;}h1, h2, h3, h4, h5, h6{font-family:"Century Gothic", Verdana, "Sans";}h1, h2, h3, h4, p{margin-bottom:0.88em;}h1{font-size:1.8em;margin:0.27em 0 1.11em 0;}h1 > code, h2 > code, h3 > code, h4 > code, h5 > code, h6 > code{font-size:1em;background-color:inherit;}h2{font-size:1.44em;margin:0.55em 0 0.55em 0;padding-top:0.55em;border-bottom:1px solid Silver;}h3{margin:0;margin-top:0.55em;font-size:1.22em;}nav h3{font-size:0.88em;margin-left:0.83em;margin-bottom:0.27em;}h4{font-size:1em;margin:0;margin-top:0.55em;}h5{font-size:0.94em;margin:0;margin-top:0.66em;padding:0;}h6{font-size:0.88em;margin:0;margin-top:0.66em;padding:0;}a{color:#0099ff;margin:0;padding:0;vertical-align:baseline;}a:visited{color:purple;}a.autoheader_anchor{text-decoration:none;}ul{list-style-type:disc;}ul, ol{padding:0;margin:0;}dd{padding-top:0.25em;}p.first_dd{padding-top:0.25em;}li > ul, ol{padding-bottom:0;}li{line-height:1.3;margin-left:1.38em;margin-bottom:0.55em;}ul > li{margin-left:2.5em;}ol > li{margin-left:2.5em;}li ul{margin-left:0.55em;}li ul{margin-left:0.27em;}li p{padding:1px 0 0 0;margin:0.55em 0 0.27em 0;line-height:1.3;}ul, ol{line-height:1.3;padding:0.33em 0 0 0;margin:0.5em;}p{line-height:1.2;padding:0.40em 0 0 0;margin:0;}pre{overflow:scroll;padding:0.55em 0.27em;margin:0.55em 0 0.55em 0 !important;background-color:#faebd7;color:#3e3e3e;border:1px Silver dashed;display:block;font-family:APLFont, monospace;font-weight:normal;white-space:pre-wrap;}pre > code{line-height:1.2;border:0;padding:0;margin:0;background-color:inherit;color:inherit;font-weight:inherit;white-space:pre-wrap;}td code{padding:0;}a code{padding:0;font-size:1em;}nav code{background-color:inherit;font-weight:400;color:inherit;}code{font-family:APLFont, monospace;color:Black;font-weight:800;line-height:1.2;font-size:0.88em;margin:0;color:#950000;padding:0 0.16em;}tbody tr:nth-child(even){background-color:#F0F0F0;}th{background-color:#E6E6E6;color:black;}th, td{padding:0.16em 0.55em;vertical-align:top;}table td + td{border-left:1px solid gray;}table th + th{border-left:1px solid gray;}table{border-color:Black;margin:1.5em 0;border:2px black;border-collapse:collapse;font-family:APLFont;font-size:0.88em;line-height:1.2;border:1px solid Gray;}li > table{margin:0.55em 0 0.55em 0;}tr{margin:1.11em;}th{font-weight:bold;}tfoot td{font-weight:bold;}blockquote{border-left:0.27em solid silver;padding-left:0.27em;margin:0.83em 0.27em 0.83em 0.55em;}blockquote ul li{margin-left:1.38em;}blockquote ol li{margin-left:1.38em;}li > blockquote{margin-left:0;}nav{background-color:#f5f5f5;border:1px solid Black;padding:0.55em;margin:0.55em;margin-right:0;box-shadow:0.27em 0.27em 0.27em Gray;overflow:hidden;clear:both;}nav#main_nav{position:fixed;top:0;right:0.55em;float:none;width:auto;}nav#main_nav_no_collapse li{font-size:0.77rem;}nav#main_nav_no_collapse li{line-height:1.5;}nav ul{list-style-type:none;margin:0 0 0.11em 0;padding:0;}nav a:visited{color:black;}nav ul li{margin-bottom:0.16em;}nav li p{margin:0;padding:0;line-height:1;margin:0;padding:0;}nav li{font-size:0.75rem;line-height:1.3;padding:0;margin-top:0;margin-bottom:0;margin-left:0.83em;}nav p{font-weight:bold;font-size:0.75rem;padding-top:0;}dl{margin-top:0.1em;margin-bottom:0.1em;}dt{margin-top:0.75em;margin-bottom:0.1em;font-weight:800;}label#hide_toc_label{font-size:0.8em;}.toc-container{position:relative;height:auto;}div.toc-container h1{font-size:0.88em;margin:0.27em 0 0.27em 0;}[type="checkbox"]{position:absolute;left:-9999px;}label{display:block;width:100%;height:1.1em;cursor:pointer;top:0;padding-left:1.1em;}label:before{content:'Table of contents \25BC';font-weight:bold;font-size:90%;padding-bottom:0;}[type="checkbox"] ~ div{display:none;}[type="checkbox"]:checked ~ div{display:block;margin-top:1.1em;}[type="checkbox"]:checked + label{top:100%;}[type="checkbox"]:checked + label:before{content:'Table of contents ‚ñ≤';}div#footnotes_div p{line-height:1;padding-bottom:0;padding-top:0;}div#footnotes_div ol{padding-top:0;}@font-face{font-family:"APLFont";src:local("APL385 Unicode"), url("https://misc.aplteam.com/apl385.ttf") format("truetype");}.no_display{display:none;}.red{color:red;}.center{text-align:center;margin-left:auto;margin-right:auto;}.left{text-align:left;margin-right:0 auto;}.right{text-align:right;margin-left:0 auto;}img{margin-top:0.55em;margin-bottom:0.27em;}div.leanpub{padding:0.83em 0.55em 1.11em 0;margin:0.55em 0 0 0.27em;overflow:auto;}div.leanpub_A{border:1px solid black;background-color:#f1f1f1;padding:0.55em;margin:1.11em 0 0.83em 0;}div.leanpub h3, div.leanpub_A h3{font-size:1.2em;padding:0;margin:0;}div.leanpub h4, div.leanpub_A h4{font-size:1.1em;padding:0.27em 0 0 0;margin:0;}div.leanpub h5, div.leanpub h5{font-size:1.0em;padding:0.27em 0 0 0;margin:0;}div.leanpub_A h5, div.leanpub_A h5{font-size:1.0em;padding:0.27em 0 0 0;margin:0;}div.leanpub img{padding:0;margin:0 1.11em 0.27em 0;}div.leanpub_A > p:first-child{padding-top:0;margin-top:0;}div.leanpub img{float:left;padding:0;margin:0.55em 1.11em 0 0;clear:both;}div.leanpub tbody *{background-color:transparent;}div.leanpub p{padding:0.17em 0 0 0;margin:0;}span.leanpub_code{color:Red;}div.leanpub p{display:block;padding:0.44em 0 0 0;}div.leanpub > div{margin-left:2.27em;}.print_only{display:none;}
</style>
<style media="print">
@page{margin:25mm 20mm 25mm 20mm;}body{font-family:"Bookman Old Style", "Callisto MT", Bookman,"Goudy Old Style", Garamond, serif;font-size:9pt;line-height:1.2;}h1{font-size:170%;}h2{font-size:110%;}h3{font-size:110%;}h4{font-size:105%;}h5{font-size:100%;}h6{font-size:95%;}h1{margin:0 0 20pt 0;}h2{margin:15pt 0 3pt 0;}h3{margin:10pt 0 0pt 0;}h4{margin:10pt 0 0pt 0;}h5{margin:9pt 0 0pt 0;}h6{margin:9pt 0 0pt 0;}h1, h2, h3, h4, h5, h6{color:black;font-family:"Century Gothic", Verdana, "Sans";page-break-after:avoid;}h1 > code, h2 > code, h3 > code, h4 > code, h5 > code, h6 > code{font-size:100%;}h2{border-bottom:1pt solid Silver;padding-bottom:2pt;}.h_tag{page-break-after:avoid;break-after:avoid;}abbr[title]{border-bottom:0;text-decoration:none;}a{color:black;margin:0;padding:0;vertical-align:baseline;text-decoration:none;font-style:italic;}a.autoheader_anchor{text-decoration:none;font-style:normal;page-break-after:avoid;break-after:avoid;}ul{list-style-type:square;}ul, ol{padding:0;margin:0;}li > ul, ol{padding-bottom:0;}li{line-height:1.3;margin-left:13pt;margin-bottom:5pt;}ul > li{margin-left:25pt;}ol > li{margin-left:25pt;}li ul{margin-left:5pt;}li ul{margin-left:3pt;}li p{padding:1pt 0 0 0;margin:5pt 0 3pt 0;line-height:1.3;}p, ul, ol{line-height:1.3;padding:4pt 0 0 0;margin:0;color:black;}ul, ol{margin-top:0.75em;}pre{padding:3pt;margin:5pt 0;white-space:pre-wrap;background-color:#FAFAFA;border:1pt Silver solid;display:block;font-family:APLFont, monospace;page-break-inside:avoid;}pre code{background-color:#FAFAFA;color:Black;padding:0;margin:0 0 -6pt 0;line-height:1.1;border:0;white-space:pre-wrap;}code{font-family:APLFont, monospace;line-height:1.2;font-size:9pt;padding:3pt 1pt 3pt 1pt;color:#950000;padding:3pt 4pt 3pt 4pt;}tbody th, tfoot tr{background-color:#e6e6e6;}tbody tr:nth-child(even){background-color:#fafafa;}th{background-color:#F0F0F0;}th, td{padding:1pt 5pt;border:1px solid #E3E3E3;vertical-align:top;}table td + td{border-left:1px solid gray;}table th + th{border-left:1px solid gray;}table code{font-style:normal;padding-left:0;padding-right:0;}table{margin:1.5em 0;font-family:APLFont;font-size:9pt;padding:0;border:1pt solid silver;border-collapse:collapse;}li > table{margin:10pt 0 10pt 0;}tr{margin:20pt;}th{font-weight:bold;}tfoot td{font-weight:bold;}blockquote{border-left:5pt solid silver;padding-left:5pt;margin:8pt 3pt 8pt 8pt;}nav{background-color:#f8f8f8;border:1pt solid Gray;width:auto;float:right;padding:5pt 5pt 5pt 0;margin:5pt 0 5pt 5pt;page-break-inside:avoid;break-inside:avoid;clear:both;overflow:hidden;}nav *{font-size:75%;}nav ul{list-style-type:none;margin:0 0 2pt 0;padding:0;}nav ul li{margin-bottom:0;}nav li p{margin:0;padding:0;line-height:1;margin:0;padding:0;}nav li{font-size:9pt;line-height:1;padding:0;margin-top:0;margin-bottom:0;margin-left:8pt;}dl{margin-top:0;margin-bottom:10pt;}dt{margin-top:10pt;margin-bottom:0;font-weight:800;page-break-inside:avoid;}dd{margin-top:2pt;}label#hide_toc_label{font-size:65%;}.toc-container{position:relative;height:auto;margin-top:2pt;background-color:inherit;}.toc-container h3{margin:0 0 2pt 7pt;}[type="checkbox"]{display:none;}label{display:block;width:100%;height:1.1em;top:0;padding-left:10pt;}label:before{content:'Table of contents';font-weight:bold;font-size:140%;padding-bottom:10pt;}a.external_link::before{content:" üåé";}a.bookmark_link::before{content:" ‚ûØ";}a.mailto_link::before{content:" ‚úâ"}nav a.bookmark_link{font-style:normal;}nav p{margin-left:10pt;font-weight:bold;font-size:9pt;}nav a{font-style:normal;}nav a.bookmark_link::before{content:"";}div#footnotes_div a::before{content:"";}div#footnotes_div a{font-style:normal;}div#footnotes_div{page-break-inside:avoid;}@font-face{font-family:"APLFont";src:local("APL385 Unicode"), url("https://misc.aplteam.com/apl385.ttf") format("truetype");}.no_print{display:none;}.red{color:red;}.center{text-align:center;margin:0 auto;}.left{text-align:left;margin-right:0 auto;}.right{text-align:right;margin-left:0 auto;}.avoid_page_break{page-break-inside:avoid;}.page_break_before{page-break-before:always;}div.leanpub{margin:10pt 0 10pt 8pt;page-break-inside:avoid;}div.leanpub_A{border:1pt solid black;background-color:#f9f9f9;padding:5pt;margin:10pt 0 10pt 0;page-break-inside:avoid;}div.leanpub h3, div.leanpub_A h3{font-size:1.2em;padding:3pt 0 0 0;margin:0;}div.leanpub h4, div.leanpub_A h4{font-size:1.1em;padding:3pt 0 0 0;margin:0;}div.leanpub h5, div.leanpub h5{font-size:1.0em;padding:3pt 0 0 0;margin:0;}div.leanpub_A h5, div.leanpub_A h5{font-size:1.0em;padding:3pt 0 0 0;margin:0;}div.leanpub img{padding:0;margin:0 10pt 2pt 0;}div.leanpub_A > p:first-child{padding-top:0;margin-top:0;}div.leanpub > div > h1:first-child{padding-top:5pt;}div.leanpub img{float:left;padding:0;margin:5pt 10pt 0 0;clear:both;}div.leanpub p{padding:3pt 0 0 0;margin:0;}span.leanpub_code{font-weight:bold;}div.leanpub p{display:block;padding:8pt 0 0 0;}div.leanpub > div{margin-left:35pt;}sup{font-size:0.75em;line-height:0;position:relative;vertical-align:baseline;top:-0.4em;}
</style>
<meta name="author" content="kai">
</head>
<body>
<div class="h_tag">
<a href="#Tatins-Load-and-Update-Strategy" id="Tatins-Load-and-Update-Strategy" class="autoheader_anchor">
<h1 data-id="Tatins-Load-and-Update-Strategy">Tatin's Load and Update Strategy</h1>
</a>
</div>
<p>Tatin is based on the concept of <a href="https://semver.org" class="external_link" title="Link to the document that introduced SemVer">semantic versioning (SemVer)</a>, so before we go into any details we first need to understand SemVer.</p>
<p>If you are familiar with SemVer then please skip this and carry on with ‚ÄúThe Strategy Problem‚Äù.</p>
<div class="h_tag">
<a href="#What-is-Semantic-Versioning" id="What-is-Semantic-Versioning" class="autoheader_anchor">
<h2 data-id="What-is-Semantic-Versioning">What is Semantic Versioning (SemVer)?</h2>
</a>
</div>
<div class="h_tag">
<a href="#Format" id="Format" class="autoheader_anchor">
<h3 data-id="Format">Format</h3>
</a>
</div>
<p>The version number of a Tatin package must follow the rules for Semantic Versioning: it always has the format <code>{major}.{minor}.{patch}</code>. After <code>{patch}</code> there might be more information available, separated from the patch number by either a dot or a hyphen, but this is just for convenience; Tatin would simply ignore any additional pieces of information.</p>
<p>Valid examples for a version number are therefore:</p>
<pre><code>0.1.0
1.0.0
12.23.199
2.3.4.1456
1.2.3-beta-1</code></pre>
<p>The Semantic Versioning rules lay out when exactly which part of the version number may or must be bumped.</p>
<div class="h_tag">
<a href="#Versioning-Rules" id="Versioning-Rules" class="autoheader_anchor">
<h3 data-id="Versioning-Rules">Versioning Rules</h3>
</a>
</div>
<p>Given <code>1.2.3.4</code> the <code>1</code> is called the <em>major version number</em>, the <code>2</code> is called the <em>minor version number</em>, the <code>3</code> is called the <em>patch number</em> and the (optional) <code>4</code> is called the <em>build number</em>.</p>
<div class="h_tag">
<a href="#The-Build-Number" id="The-Build-Number" class="autoheader_anchor">
<h4 data-id="The-Build-Number">The Build Number</h4>
</a>
</div>
<p>The build number is bumped whenever the package is built again, not matter what. It is never reset. The build number is optional and is ignored by Tatin.</p>
<div class="h_tag">
<a href="#The-Patch-Number" id="The-Patch-Number" class="autoheader_anchor">
<h4 data-id="The-Patch-Number">The Patch Number</h4>
</a>
</div>
<p>The patch number is bumped only <em>when a change does not affect compatibility</em>.</p>
<p>A typical example is a bug fix: imagine that a particular piece of data crashes a function in the package. When you fix that problem then you may bump the patch number because nothing else has changed. A consumer of the package can be sure that everything that worked before will still work.</p>
<p>In real life things get messy pretty quickly: imagine that the function produces a wrong result instead of crashing. Fixing could cause a consumer of the package a headache in case she coded in a way that makes her application now <em>relying</em> on the bug.</p>
<p>If chances are high that a consumer might rely on the bug then you should actually bump the Major number rather than the Patch number - see there.</p>
<div class="h_tag">
<a href="#The-Minor-Number" id="The-Minor-Number" class="autoheader_anchor">
<h4 data-id="The-Minor-Number">The Minor Number</h4>
</a>
</div>
<p>The minor version number is bumped in case functionality was added to a package.</p>
<p>That means that compatibility should still be guaranteed: anything else works exactly as before. A consumer should be confident when updating the package that nothing will break. She just may take advantage of, say, a function added to the API.</p>
<div class="leanpub_A">
<h3>Chances of breaking things</h3>
<p>Note that by definition it seems that a change of the minor number is indicating a lower risk: just adding functionality should never change anything that has worked before, while a change in the patch number might come from a bug fix your code actually relies on.</p>
<p>In reality however a version with a new (bumped) minor number might not only add functionality, it might also come with a couple of bug fixes.</p>
</div>

<div class="h_tag">
<a href="#The-Major-Number" id="The-Major-Number" class="autoheader_anchor">
<h4 data-id="The-Major-Number">The Major Number</h4>
</a>
</div>
<p>When you change the API not by just adding stuff but by deleting or renaming parts of the public interface, or changing the parameters that an API function requires, then the package is incompatible with earlier versions. If that's the case then you must bump the major version number.</p>
<div class="h_tag">
<a href="#Example" id="Example" class="autoheader_anchor">
<h4 data-id="Example">Example</h4>
</a>
</div>
<p>These two packages:</p>
<pre><code>aplteam-foo-1.0.0
aplteam-GOO-1.0.0</code></pre>
<p>‚Ä¶ are of course considered to be different packages, but according to the concept of SemVer these two packages:</p>
<pre><code>aplteam-foo-1.0.0
aplteam-foo-2.0.0</code></pre>
<p>‚Ä¶ are also considered to be different packages.</p>
<p>Tatin reflects that by listing all major versions of a package when this user command is invoked:</p>
<pre><code>      ]tatin.ListPackages</code></pre>
<div class="h_tag">
<a href="#Why-Semantic-versioning" id="Why-Semantic-versioning" class="autoheader_anchor">
<h3 data-id="Why-Semantic-versioning">Why Semantic versioning?</h3>
</a>
</div>
<p>Before the introduction of the rules of Semantic Versioning everybody assigned version numbers to their liking. Updating to a new version always carried a significant risk that things would break.</p>
<p>With the rules of Semantic Versioning in place if everybody involved acts accordingly and sensibly, updating should be safe.</p>
<p>Of course people could and will make still mistakes, so there is still a chance that a new version will break things anyway, but there is now a much better chance that things keep working after an update than before the introduction of Semantic Versioning.</p>
<div class="h_tag">
<a href="#The-Strategy-Problem" id="The-Strategy-Problem" class="autoheader_anchor">
<h2 data-id="The-Strategy-Problem">The Strategy Problem</h2>
</a>
</div>
<p>Let's imagine that you need two packages, <code>Foo</code> and <code>Goo</code>. Both rely on package <code>Zoo</code>, but while <code>Foo</code> requests 1.1.1 of <code>Zoo</code>, <code>Goo</code> insists on version 1.2.0. However, the best version of <code>Goo</code> available is actually 1.3.0.</p>
<p>Because of SemVer we know that <code>Goo</code> would crash on version 1.1.1 of <code>Zoo</code> in case it takes advantage of the new features built into version 1.2.0. (We know there <em>are</em> new features because of the bump of the minor part of <code>Zoo</code>'s version number)</p>
<p>We can take several different approaches here:</p>
<ul>
<li>We could load both versions and make <code>Foo</code> use version 1.1.1 and <code>Goo</code> use version 1.2.0</li>
<li>We could load the better version (1.2) and make <code>Zoo</code> and <code>Goo</code> both use that version</li>
<li>We could check the server, find that there is a better version available (1.3.0) and use that one
<p>(More generally, always check for a better version, and if there is one, use it)</p></li>
</ul>
<p>All these options are actually used by different package managers in the wild, so there is no consensus what's best.</p>
<p>To many programmers the last option seems particularly appealing because your application is kind of living on the bleeding edge this way: you are always up-to-date, you always get the latest fixes when you build your application. Great!</p>
<p>But when you look at it from a different angle then things look much less appealing:</p>
<ol start="1">
<li>You build your application</li>
<li>You run your test cases ‚Äì they all pass</li>
<li>You build your application again (without changing <em>anything</em>)</li>
<li>You run your test cases again, but this time they fail</li>
</ol>
<p>Attractive as an automated update mechanism might be, you want a build to be <em>reproducible</em>.</p>
<p>That does not necessarily mean that you always need to update all packages in your application ‚Äúby hand‚Äù, there are smarter ways to do this, and we will discuss this later.</p>
<p>So, when asked to load installed packages, Tatin will just do exactly that: load the packages it has recorded as required when installing <code>Foo</code> and <code>Goo</code>.</p>
<p>Except when a package is requested more than once, and with different version numbers: in that case Tatin uses <em>the best of them</em>, which might or might not be the best one available.</p>
<p>This is called <a href="https://research.swtch.com/vgo-mvs" class="external_link" title="Link to the paper defining it">‚ÄúMinimal Version Selection‚Äù</a>. It guarantees that when you re-build, you will get exactly the same result again.</p>
<div class="h_tag">
<a href="#Loading-Dependencies" id="Loading-Dependencies" class="autoheader_anchor">
<h2 data-id="Loading-Dependencies">Loading Dependencies</h2>
</a>
</div>
<p>Imagine these packages:</p>
<pre><code>    +-----------+        +-----------+
    | Foo 1.0.0 |        | Goo 2.1.0 |
    +-----------+        +-----------+
          |                   |
          |                   |
          ‚à®                   ‚à®
    +-----------+        +-----------+
    | Zoo 1.1.1 |        | Zoo 1.2.0 |
    +-----------+        +-----------+</code></pre>
<p>For simplicity we will assume that the packages are all hosted by a Tatin server known under the alias name <code>MyTatin</code></p>
<p>While <code>Foo</code> relies on <code>Zoo</code> 1.1.1, <code>Goo</code> needs <code>Zoo</code> 1.2.0 ‚Äî what is Tatin doing about this?</p>
<p>It depends on what you are doing. Let's first load <code>Zoo</code> and <code>Goo</code> into the workspace, the usual approach to inspect a package:</p>
<pre><code>      ]TATIN.Loadpackage [MyTatin]/mygroup-Foo-1.0.0 #.MyPkgs
#.MyPkgs.Foo
      ]TATIN.Loadpackage [MyTatin]/mygroup-Goo-2.1.0 #.MyPkgs
#.MyPkgs.Goo
      #.MyPkgs.‚éïnl ‚ç≥16
Foo
Goo</code></pre>
<div class="leanpub_A">
<h3>Getting the best version</h3>
<p>Assuming that version 1.0.0 of <code>Foo</code> is the best version available with the major number 1, then this would have been sufficient:</p>
<pre><code>]TATIN.Loadpackage [MyTatin]/mygroup-Foo-1 #.MyPkgs</code></pre>
<p>Note that neither the minor nor the patch number have been specified.</p>
<p>Assuming that version 2.1.0 of <code>Goo</code> is the very best version available at all, and that's the version you want to use, then this would have been sufficient:</p>
<pre><code>]TATIN.Loadpackage [MyTatin]/mygroup-Goo #.MyPkgs</code></pre>
<p>Note that neither the major nor the minor nor the patch number have been specified.</p>
</div>

<p>You wanted <code>Foo</code> and <code>Goo</code> to be loaded into <code>#.MyPkgs</code>, and that's exactly what Tatin did. But where are the dependencies?</p>
<p>Note that <code>#.MyPkgs</code> just carries references pointing to where the packages have really been loaded into, and that is the namespace <code>#._tatin</code>:</p>
<pre><code>      #._tatin.‚éïnl 9
mygroup_Foo_1_0_0
mygroup_Goo_2_1_3
mygroup_Zoo_1_1_1
mygroup_Zoo_1_2_0</code></pre>
<p>Note that both versions of <code>Zoo</code> have been loaded. That's because the two Load operations are independent of each other.</p>
<div class="h_tag">
<a href="#Installing-packages" id="Installing-packages" class="autoheader_anchor">
<h2 data-id="Installing-packages">Installing packages</h2>
</a>
</div>
<p>To make packages a part of an application (say), they first need to be installed. In the following examples we will install two packages, <code>Foo</code> and <code>Goo</code>. Both require <code>Zoo</code>, so <code>Zoo</code> will be installed as a side effect.</p>
<pre><code>      ‚éïNEXISTS /myPkgs
0
      ]TATIN.Installpackage [MyTatin]/mygroup-Foo-1.0.0 /myPkgs/
/myPkgs/mygroup-Foo-1.0.0
      ]TATIN.Installpackage [MyTatin]/mygroup-Goo-2.1.0 /myPkgs/
/myPkgs/mygroup-Goo-2.1.0
      ‚ç™‚äÉ‚éïNINFO ‚ç† 1‚ä¢'/myPkgs/*'
/myPkgs/apl-buildlist.json
/myPkgs/apl-dependencies.txt
/myPkgs/mygroup-Foo-1.0.0
/myPkgs/mygroup-Goo-2.1.0
/myPkgs/mygroup-Zoo-1.1.1
/myPkgs/mygroup-Zoo-1.2.0</code></pre>
<p>Let's check the contents of the <code>/myPkgs/apl-dependencies.txt</code> file:</p>
<pre><code>      ‚äÉ‚éïNGET '/myPkgs/apl-dependencies.txt'
mygroup-Foo-1.0.0
mygroup-Goo-2.1.0</code></pre>
<p>Note that these are the principal packages that we've installed.</p>
<p>Let's check the contents of the <code>/myPkgs/apl-buildlist.json</code> file:</p>
<pre><code>      #.q‚Üê‚éïJSON‚ç†('Dialect' 'JSON5')‚ä¢‚äÉ‚éïNGET'/myPkgs/apl-buildlist.json'
      ‚çâ‚Üë#.q.(depth packageID url)
1 mygroup-Foo-1.0.0
2 mygroup-Zoo-1.1.1
1 mygroup-Goo-2.1.0
2 mygroup-Zoo-1.2.0</code></pre>
<p>Note that the principal packages carry a 1 in the first column. Numbers higher than 1 indicate the level of dependency.</p>
<p>The build list comprises not only the two principal packages but also all dependencies.</p>
<div class="h_tag">
<a href="#Loading-the-installed-packages" id="Loading-the-installed-packages" class="autoheader_anchor">
<h2 data-id="Loading-the-installed-packages">Loading the installed packages</h2>
</a>
</div>
<p>Though installing is roughly the same as loading except that the packages end up in the file system rather than the workspace, loading the installed packages allows Tatin to optimize what's actually loaded, and in this respect it is different.</p>
<p>Installed packages are loaded with the Tatin user command <code>LoadDependencies</code> which takes a folder as argument that must have a file <code>apl-dependencies.txt</code> but also a file <code>apl-buildlist.json</code> which gets created ‚Äî or extended ‚Äî by the installation process.</p>
<p>It also requires a namespace as second argument: that's where the references pointing to the principal packages are going to be created. This is similar to <code>LoadPackage</code>.</p>
<pre><code>      ]TATIN.LoadDependencies /myPkgs/ #.Temp</code></pre>
<p>This is what <code>LoadDependencies</code> will do:</p>
<ul>
<li>It reads the file <code>apl-dependencies.txt</code>.</li>
<li>It then checks whether this file was changed <em>after</em> the file <code>apl-buildlist.json</code> was written to disk.
<p>If that is the case, the build list will be checked for consistency with <code>apl-dependencies.txt</code>; if that   is fine then the build list is created from scratch,</p></li>
<li>Finally it will prune the build list and bring in the remaining packages.</li>
</ul>
<p>Note that the pruning is in charge for removing the package <code>Zoo</code> 1.1.1. That means that rather than loading <code>Zoo</code> twice <em>only the best version</em> will be loaded: both <code>Foo</code> and <code>Goo</code> will use <code>Zoo</code> version 1.2.0.</p>
<div class="h_tag">
<a href="#Special-case" id="Special-case" class="autoheader_anchor">
<h2 data-id="Special-case">Special case</h2>
</a>
</div>
<div class="h_tag">
<a href="#Removing-a-principal-package" id="Removing-a-principal-package" class="autoheader_anchor">
<h3 data-id="Removing-a-principal-package">Removing a principal package</h3>
</a>
</div>
<p>Let's assume that you don't need <code>Goo</code> anymore.</p>
<p>Generally we advise to <em>not</em> delete stuff manually from the folder that holds all packages of an application.</p>
<p>If you want to get rid of one then it is recommended to use the method <code>]TATIN.UninstallPackage</code> instead. That will make sure that it removes not only the package in question, but also all packages that are dependencies of it, but <em>only</em> if those packages are not requested by other packages as well.</p>
<p>Clearly there is a danger that you remove too much when you attempt to do this manually.</p>
<p>However, if you want to remove just a principal package, not dependencies, for example because you <em>know</em> it does not have any, or because you <em>know</em> that all its dependencies are also required by other packages anyway, then you might do it manually, though we still don't recommend it.</p>
<p>For the purpose of discussing what Tatin would do, we assume here that you perform the following two actions:</p>
<ul>
<li>You remove the line regarding <code>Goo</code> from the <code>apl-dependencies.txt</code> file</li>
<li>You remove <code>mygroup-Goo-2.1.0</code> from the package folder (strictly speaking the following is true even when you omit this step)</li>
</ul>
<p>Note that at this point the file <code>apl-buildlist.json</code> would still carry information regarding <code>Goo.</code></p>
<p>Imagine you would now issue this command:</p>
<pre><code>      ]TATIN.LoadDependencies /myPkgs/ #.Temp
</code></pre>
<p>Tatin would check whether the file <code>apl-dependencies.txt</code> was changed after <code>apl-buildlist.json</code> was created by Tatin.</p>
<p>In this case this is true, so Tatin would perform some health checks, and an error would be thrown in case they fail. This is mainly an insurance against people manually changing <code>apl-dependencies.txt</code> and making obvious mistakes.</p>
<p>Since the health check passed the build-list would be re-created. As a result <code>Goo</code> would disappear from the build list, and therefore a future <code>]TATIN.LoadDependencies</code> command would not load it any more.</p>
<p>However, note this: although <code>Foo</code> only required <code>Zoo</code> 1.1.1, Tatin would <em>not</em> go back to that version, because version 1.2.0 of <code>Zoo</code> is already there. It would therefore keep loading version 1.2.0 although at this point in time this version is not referenced at all.</p>
<div class="h_tag">
<a href="#Need-to-overwrite-a-package-dependency" id="Need-to-overwrite-a-package-dependency" class="autoheader_anchor">
<h3 data-id="Need-to-overwrite-a-package-dependency">Need to overwrite a package dependency</h3>
</a>
</div>
<p>Imagine you've installed a principal packages <code>Foo</code>, and as a result you also got two dependency packages, <code>Goo</code> and <code>Zoo</code>:</p>
<p>Foo -&gt; Goo -&gt; Zoo</p>
<p>You find that sometimes <code>Zoo</code> crashes because of a bug.</p>
<p>Two different scenarios both cause a problem here:</p>
<ul>
<li>You check the project's web site and find that the guy in charge has already fixed the problem in <code>Zoo</code>, but <code>Goo</code> has not been updated and still refers¬†to the buggy version of <code>Zoo</code>.</li>
<li>You find that the version you already have is still¬†the best, and the author does not respond to emails or even Pull Requests at the moment, and you are under time pressure, but it's easy to fix the problem yourself, so you put a fixed copy into a local Registry.
<p>(Assuming that you have defined your Registry¬†chain so that local versions of packages take¬†precedence)</p></li>
</ul>
<p>The first step is obviously to install that fixed version, but that is not enough, because neither <code>apl-dependencies.txt</code> nor <code>apl-buildlist.json</code> would refer to that version, therefore it cannot be loaded.</p>
<p>Since the build-list is compiled dynamically, the solution here is to add <code>Zoo</code> to the file <code>apl-dependencies.txt</code>.</p>
<div class="leanpub_A">
<h3>Second problem</h3>
<p>There is a second problem with this:</p>
<p>In the scenario outlined in that Go-paper on semantic versioning you end up using D-1.1.4 although this version is not mentioned anywhere as a dependency, it's just part of the build list.</p>
<p>But we agreed that the build list should be re-compiled from scratch in case somebody has changed the dependency file <em>after</em> the build list file was created. In that case we would currently fall back on D-1.1.3 although we don't want that.</p>
<p>This also means that manually changing the build list is not an option in any case.</p>
</div>

<p>I propose to change that: our build list could just avoid minor and patch numbers for dependencies: it could just remember the major number.</p>
<p>When it comes to <code>LoadDependencies</code> the build list just says ‚Äúload Zoo 1‚Äù which translates to ‚Äúthe best version of Zoo 1.* available in the install folder‚Äù, and both problems disappear.</p>
</body>
</html>